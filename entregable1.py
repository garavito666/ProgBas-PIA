# -*- coding: utf-8 -*-
"""Entregable1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Ris2qOtCV9Y9ed7WGbtAjSOCvBVyDiXj

# **Entregable semana 1**
**1. Elegir una API pÃºblica**

Para este proyecto, se eligiÃ³ la API de OpenWeather, una plataforma gratuita que proporciona informaciÃ³n meteorolÃ³gica en tiempo real y pronÃ³sticos futuros para cualquier ciudad del mundo.

**Datos que entrega:** Temperatura actual, sensaciÃ³n tÃ©rmica, humedad, presiÃ³n atmosfÃ©rica, velocidad y direcciÃ³n del viento, asÃ­ como una descripciÃ³n del estado del clima. AdemÃ¡s, permite obtener un pronÃ³stico detallado para los prÃ³ximos cinco dÃ­as con datos cada 3 horas.

**Acceso**: La API requiere autenticaciÃ³n mediante una API Key gratuita que se obtiene tras crear una cuenta en openweathermap.org. Las consultas se hacen mediante peticiones HTTP GET con parÃ¡metros como la ciudad (q), unidades (units), idioma (lang) y la clave (appid).

**Utilidad**: Esta informaciÃ³n permite construir una herramienta que muestre el clima actual y predicciones futuras, lo que es Ãºtil para planear actividades, emitir alertas o realizar anÃ¡lisis climÃ¡ticos por ciudad.

**2. Definir el problema**

**El problema a resolver es**:
â€œÂ¿CÃ³mo puedo consultar el estado del clima actual y el pronÃ³stico de cualquier ciudad, desde la terminal, de forma rÃ¡pida y exportable para anÃ¡lisis posteriores?â€

Este problema es comÃºn para usuarios que necesitan monitorear condiciones meteorolÃ³gicas sin depender de navegadores o interfaces grÃ¡ficas, como usuarios de servidores, desarrolladores o investigadores. TambiÃ©n se busca que los datos sean exportables a CSV y JSON para anÃ¡lisis posterior o almacenamiento.

**3. Crear un script funcional**

Se desarrollÃ³ un script en Python que:

-Se conecta a la API de OpenWeather utilizando requests.

-Consulta y obtiene datos tanto del clima actual como del pronÃ³stico de 5 dÃ­as.

-Valida la respuesta mediante verificaciÃ³n del cÃ³digo HTTP.

-Usa funciones reutilizables y estructuradas para mejorar la legibilidad y el mantenimiento del cÃ³digo.

-AdemÃ¡s, permite cambiar la ciudad manualmente, alternar entre grados Celsius y Fahrenheit, y ofrece una detecciÃ³n automÃ¡tica de ciudad vÃ­a IP.
"""

!pip install requests
!pip install plotext
!pip install openpyxl

import requests
from datetime import datetime

API_KEY = "f0f0c07c117721896152aeca0fbbe31a"

# ğŸŒ Obtener ubicaciÃ³n por IP
def obtener_ciudad_por_ip():
    try:
        res = requests.get("http://ip-api.com/json/")
        if res.status_code == 200:
            data = res.json()
            return data.get("city", "")
    except Exception as e:
        print(f"Error al obtener ubicaciÃ³n por IP: {e}")
    return ""

# ğŸŒ¤ï¸ Obtener clima actual
def obtener_clima_actual(ciudad, unidades):
    url = f"http://api.openweathermap.org/data/2.5/weather?q={ciudad}&appid={API_KEY}&units={unidades}&lang=es"
    res = requests.get(url)
    if res.status_code == 200:
        return res.json()
    return None

# ğŸ“… Obtener pronÃ³stico
def obtener_pronostico(ciudad, unidades):
    url = f"http://api.openweathermap.org/data/2.5/forecast?q={ciudad}&appid={API_KEY}&units={unidades}&lang=es"
    res = requests.get(url)
    if res.status_code == 200:
        return res.json()
    return None

# ğŸ” Convertir unidades
def cambiar_unidad(unidad_actual):
    return "imperial" if unidad_actual == "metric" else "metric"

# ğŸ–¨ï¸ Mostrar clima
def mostrar_clima(ciudad, unidad):
    datos_actual = obtener_clima_actual(ciudad, unidad)
    datos_pronostico = obtener_pronostico(ciudad, unidad)

    if not datos_actual or not datos_pronostico:
        print("âŒ No se pudo obtener informaciÃ³n del clima.")
        return

    # SÃ­mbolos de unidad
    temp_unit = "Â°C" if unidad == "metric" else "Â°F"
    speed_unit = "m/s" if unidad == "metric" else "mph"

    print(f"\nğŸŒ Clima en {datos_actual['name']}, {datos_actual['sys']['country']}")
    print(f"ğŸŒ¡ï¸ Temperatura: {datos_actual['main']['temp']}{temp_unit}")
    print(f"ğŸ¥µ SensaciÃ³n tÃ©rmica: {datos_actual['main']['feels_like']}{temp_unit}")
    print(f"ğŸ’§ Humedad: {datos_actual['main']['humidity']}%")
    print(f"ğŸ“ˆ PresiÃ³n: {datos_actual['main']['pressure']} hPa")
    print(f"ğŸŒ¬ï¸ Viento: {datos_actual['wind']['speed']} {speed_unit}, direcciÃ³n {datos_actual['wind'].get('deg', 0)}Â°")
    print(f"ğŸ“ Estado: {datos_actual['weather'][0]['description'].capitalize()}")

    print("\nğŸ“† PronÃ³stico para los prÃ³ximos dÃ­as:")
    listado = datos_pronostico["list"]
    dias_mostrados = set()

    for item in listado:
        fecha = datetime.strptime(item["dt_txt"], "%Y-%m-%d %H:%M:%S")
        dia = fecha.strftime("%A %d/%m")

        # Mostrar solo una vez por dÃ­a (aprox. al mediodÃ­a)
        if dia not in dias_mostrados and "12:00:00" in item["dt_txt"]:
            dias_mostrados.add(dia)
            print(f"\nğŸ—“ï¸ {dia}")
            print(f"   ğŸŒ¡ï¸ Temp: {item['main']['temp']}{temp_unit}")
            print(f"   ğŸ“ Estado: {item['weather'][0]['description'].capitalize()}")

# ğŸ§­ MenÃº principal
def main():
    print("ğŸŒ¦ï¸ Bienvenido a la aplicaciÃ³n del clima en terminal ğŸŒ¦ï¸")

    unidad = "metric"
    ciudad = obtener_ciudad_por_ip()

    if not ciudad:
        ciudad = input("â“ No se pudo detectar tu ciudad. Ingresa una ciudad: ")
    else:
        print(f"ğŸ“ Ciudad detectada automÃ¡ticamente: {ciudad}")

    while True:
        mostrar_clima(ciudad, unidad)
        print("\nOpciones:")
        print("1. Cambiar ciudad")
        print("2. Cambiar unidad (Â°C / Â°F)")
        print("3. Actualizar datos")
        print("4. Salir")

        opcion = input("ğŸ‘‰ Elige una opciÃ³n: ")

        if opcion == "1":
            ciudad = input("ğŸ“ Ingresa una nueva ciudad: ")
        elif opcion == "2":
            unidad = cambiar_unidad(unidad)
        elif opcion == "3":
            continue
        elif opcion == "4":
            print("ğŸ‘‹ Â¡Hasta luego!")
            break
        else:
            print("âŒ OpciÃ³n no vÃ¡lida.")

if __name__ == "__main__":
    main()